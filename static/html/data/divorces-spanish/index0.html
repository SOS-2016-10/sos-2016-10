<!-- Pagina de /data/divorces-spanish "https://sos-2016-10.herokuapp.com/data/divorces-spanish/" -->
<html>
<head>
  <link href="/style.css" rel="stylesheet" type="text/css">
  <title>Divorces Spanish</title>
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>

  <!-- Funciones divorces-spanish -->
	<script type="text/javascript" src="/data/divorces-spanish/htmlFunctions.js"></script>

  <!-- DATATABLES -->
  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.11/css/jquery.dataTables.css">
  <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.11/js/jquery.dataTables.js"></script>

  <!-- DataTables para seleccionar y eliminar 1 fila -->
	<!--<script type="text/javascript" charset="utf8" src="//code.jquery.com/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script> -->

  <script>
    $(document).ready(function (){
      console.log("JQuery ready");
      var request= $.ajax({
        type: "GET",
        url:"/api/v1/divorces-spanish?apikey=juanlur"
      });

      request.done((data,status,jqXHR)=>{
        //$(document).ready( function () {
        $("#columns").DataTable( {
          data: data,//parsedData
          "columns": [
            { data: "autonomous_community" },
            { data: "year"},
            { data: "age_0_18"},
            { data: "age_19_24"},
            { data: "age_25_29"},
            { data: "age_30_34"}
          ]
        });

        var table = $("columns").DataTable(); //Tabla "table"
        //**** Seleccionar una fila ****
        $('#columns tbody').on( 'click', 'tr', function () {
            if ( $(this).hasClass('selected') ) { //Si está en Clase "selected"
                $(this).removeClass('selected'); //entonces lo quito de "selected"
            }
            else {
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected'); //Añado a la clase "selected"
            }
        });

        //Eliminar todo
    		$('#DELETE_ALL').on( 'click', function () {
					//table.row('.selected').remove().draw( false );
					var row = table.row('.selected');
					console.warn(row.name);
					//var url = '/api/v1/beaches/' + row.name;
					var request = $.ajax({
						url : "/api/v1/divorces-spanish?apikey=juanluw",
						type : "delete",
						dataType : "json"
					});
					//location.reload(); //Reload
				});

        ////UPDATE
				$('#button_update').click( function () {
			    var row = table.rows('.selected').data();
			    var datos = "";
			    datos += '{"autonomous_community"='; //1º campo lo cojo del objeto,pk es "key" y no puede modificarse
					datos += '"';
					datos += row[0].autonomous_community;
					datos += '"';
					datos += ',';
					datos += '"year"=';
					datos += $("#provinceU").val();
					datos += ',';
					datos += '"town"=';
					datos += $("#townU").val();
					datos += ',';
					datos += '"length"=';
					datos += $("#lengthU").val();
					datos += ',';
					datos += '"width"=';
					datos += $("#widthU").val();
					datos += '}';
					var request = $.ajax({
						type : "PUT",
						url : "/api/v1/divorces-spanish/"+row[0].name+"?apikey=juanluw",
						dataType : 'json',
						data : datos
					});
			  } );
 				////finUPDATE

        // ***** Eliminar 1 Fila *****
    		$('#DELETE').click( function () {
    			var row = table.rows('.selected').data();
					var request = $.ajax({
						url : "/api/v1/beaches/" + row[0].name,
						type : "delete",
						dataType : "json"
					});
				});
        //}); //fin ready
      }); //fin done

      request.always((jqXHR,status)=>{
      });

    }); //FIN ready
    //location.reload();
    </script>
</head>
<body>
  <h1>Divorces Spanish</h1>
  <p>Hello, My data is related to the number of divorces in Spain. I will get the info from this source: <a href="http://www.ine.es/jaxi/menu.do?type=pcaxis&path=/t18/p420/p01/&file=inebase">here.</a></p>

  <!--Tabla -->
  <!-- Columnas -->
  <table id="columns">
    <thead>
      <tr>
        <th>autonomous-community</th>
        <th>year</th>
        <th><18 age</th>
        <th>19<24 age</th>
        <th>25<29 age</th>
        <th>30<34 age</th>
      </tr>
    </thead>
  </table>

  <!-- ******************* BOTONES *************************** -->
	<input id="POST" type="button" value="Add" onclick="mostrar()"/>
	<input id="PUT" type="button" value="Update" onclick="mostrarUpdate()" />
	<input id="DELETE_ALL" type="button" value="Delete ALL" />
	<input id="DELETE" type="button" value="Delete selected ALL" onclick="reload()" />

  <!-- ******************* FORMULARIO OCULTO ****************** -->
	<div id="oculto" style="display:none;">
	<hr>
	<form id="fm" method="post">
				<div class="fitem">
					<label>Autonomous Community Name:</label> <input id="autonomous-community" name="autonomous-community"
						class="easyui-validatebox" required="true">
				</div>
				<div class="fitem">
					<label>Year:</label> <input id="year"
						name="year" class="easyui-validatebox" required="true">
				</div>
				<div class="fitem">
					<label>Age < 18:</label> <input id="age_0_18" name="age_0_18"
						class="easyui-validatebox" required="true">
				</div>
				<div class="fitem">
					<label>Age 19<24:</label> <input id="age_19_24" name="age_19_24"
						class="easyui-validatebox" required="true">
				</div>
				<div class="fitem">
					<label>Age 25<29</label> <input id="age_25_29" name="age_25_29"
						class="easyui-validatebox" required="true">
				</div>
        <div class="fitem">
					<label>Age 30<34</label> <input id="age_30_34" name="age_30_34"
						class="easyui-validatebox" required="true">
				</div>
				<div>
					<button id="sendPost" class="easyui-linkbutton" iconCls="icon-ok"
						onclick="post()">Add</button>
				</div>
			</form>
	</div>

	<!-- ******************* FORMULARIO OCULTO UPDATE *********** -->
	<div id="ocultoUpdate" style="display:none;">
	   <hr>
	    <form id="fp" method="put">
      <!-- <div class="fitem">
        <label>Autonomous Community Name:</label> <input id="autonomous-community" name="autonomous-community"
        class="easyui-validatebox" required="true">
      </div> -->
      <div class="fitem">
        <label>Year:</label> <input id="year"
          name="year" class="easyui-validatebox" required="true">
      </div>
      <div class="fitem">
        <label>Age < 18:</label> <input id="age_0_18" name="age_0_18"
          class="easyui-validatebox" required="true">
      </div>
      <div class="fitem">
        <label>Age 19<24:</label> <input id="age_19_24" name="age_19_24"
          class="easyui-validatebox" required="true">
      </div>
      <div class="fitem">
        <label>Age 25<29</label> <input id="age_25_29" name="age_25_29"
          class="easyui-validatebox" required="true">
      </div>
      <div class="fitem">
        <label>Age 30<34</label> <input id="age_30_34" name="age_30_34"
          class="easyui-validatebox" required="true">
      </div>
      <div>
        <button id="button_update" class="easyui-linkbutton" iconCls="icon-ok" >Update</button>
      </div>
	   </form>
	</div>
</body>
</html>
