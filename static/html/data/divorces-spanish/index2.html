<html>
  <head>
    <!-- <link href="/style.css" rel="stylesheet" type="text/css"> -->
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>
    <script>
      $(document).ready(function() {

        var ac;
        var year;


        console.log("JQuery Ready!");
        $("#button").click(()=>{
          //$("#log").html("<h1>HELLO WORLD!!!!</h1>");
          console.log("Handling click");

          var urlHTML = $("#url").val();
          var method = $("input[type=radio]:checked").attr("id");
          var dataJSON = $("#payload").val();
          //console.log("DataJSON = "+dataJSON.text());
          var request = $.ajax({
            url: urlHTML,//"/api/v1/divorces-spanish?apikey=juanlur",
            type: method,
            data: $("#payload").text(dataJSON), ///
            //dataType: 'json', ///
            contentType: "application/json"
            //cache: false
          });
          console.log(request);

          //Request done
          request.done(function(data,status,jqXHR) {//Se ejecuta cuando la petici√≥n haya sido correcta
            // Tratamiento en caso de exito
            console.log("Handling request (OK)");
            console.log(data);
            var row = '';
            $.each(data, function(index, value){
              row = row + ("<tr><td>"+data[index].autonomous_community+"</td><td>"+data[index].year+"</td><td>"+data[index].age_0_18+"</td><td>"+data[index].age_19_24+"</td><td>"+data[index].age_25_29+"</td><td>"+data[index].age_30_34+"</td></tr>");
            });
            $(tableRow).append(row);
          });


          //Request always
          request.always(function(jqXHR, status){
            if(jqXHR.status == undefined){
              $("#status").text("OK");
            } else {
              $("#status").text(jqXHR.status + " " + jqXHR.statusText);
            }
          });
        }); //END #button.click
      }); //END document.ready
    </script>
  </head>
  <body>
    <h1>JQuery REST Client</h1>
      URL: <input id="url" size="30" value="/api/v1/divorces-spanish?apikey=juanlur"/>
      GET <input name="method" type="radio" id="GET" checked="checked"/> &nbsp;&nbsp;
      POST <input name="method" type="radio" id="POST" /> &nbsp;&nbsp;
      PUT <input name="method" type="radio" id="PUT" /> &nbsp;&nbsp;
      DELETE <input name="method" type="radio" id="DELETE" /> &nbsp;&nbsp;
    <br/>
      Payload: <input id="payload" size="60" value='{ "autonomous_community": "aa", "year": 2014, "age_0_18": 0, "age_19_24": 6, "age_25_29": 69, "age_30_34": 235 }'/>
    <br/><br/>
      <span id="button">Send</span>
    <br/><hr/>
      HTTP Status: <span id="status"></span>
    <br/><hr/>
      <span id="data">
        <table id="tableData" border='1'>
          <tr>
            <th>autonomous_community</th>
            <th>year</th>
            <th>age_0_18</th>
            <th>age_19_24</th>
            <th>age_25_29</th>
            <th>age_30_34</th>
          </tr>
        </table>
        <table id="tableRow" border='1'></table>
      </span>
    <br/><hr/>
      <ul id="list"></ul>
    <hr/>
      Log: <span id="log"></span>
  </body>
</html>
